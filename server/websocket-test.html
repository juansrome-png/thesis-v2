<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Test</title>
</head>
<body>
    <h1>Financial API WebSocket Test</h1>
    <div id="status">Connecting...</div>
    <div id="data"></div>
    
    <script>
        const ws = new WebSocket('ws://localhost:3002');
        const status = document.getElementById('status');
        const data = document.getElementById('data');
        
        ws.onopen = () => {
            status.textContent = 'Connected!';
            status.style.color = 'green';
            
            // Subscribe to AAPL and NVDA
            ws.send(JSON.stringify({
                type: 'subscribe',
                symbols: ['AAPL', 'NVDA', 'MSFT']
            }));
        };
        
        ws.onmessage = (event) => {
            const message = JSON.parse(event.data);
            console.log('Received:', message);
            
            if (message.type === 'data' || message.type === 'update') {
                data.innerHTML = '<h3>Real-time Data:</h3>';
                for (const [symbol, quote] of Object.entries(message.data)) {
                    data.innerHTML += `
                        <div style="border: 1px solid #ccc; margin: 10px; padding: 10px;">
                            <strong>${symbol}</strong><br>
                            Price: $${quote.price.toFixed(2)}<br>
                            Change: ${quote.change >= 0 ? '+' : ''}$${quote.change.toFixed(2)} (${quote.changePercent.toFixed(2)}%)<br>
                            Volume: ${quote.volume.toLocaleString()}<br>
                            Source: ${quote.source}
                        </div>
                    `;
                }
            }
        };
        
        ws.onerror = (error) => {
            status.textContent = 'Error: ' + error;
            status.style.color = 'red';
        };
        
        ws.onclose = () => {
            status.textContent = 'Disconnected';
            status.style.color = 'orange';
        };
    </script>
</body>
</html>
